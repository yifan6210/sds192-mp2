---
title: "Mini-Project 2"
author: "Yifan Ma & Meghan Suslovic"
date: "March 7, 2018"
output: 
  html_document:
    code_folding: hide

---

**Money and Power: Swing States**


```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE, echo=TRUE)
```


```{r, include=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r}
library(tidyverse)
library(maps)
library(mapdata)
library(ggthemes)
library(RColorBrewer)
```

```{r}
committees2<- committees %>%
  select(cmte_id:connected_org_name)

all <- house_elections %>%
  left_join(contributions, by = c("fec_id" = "cand_id")) %>%
  group_by(fec_id,ge_winner) %>%
  summarise(S = sum(transaction_amt))%>%
  filter(!is.na(S))%>%
  group_by(ge_winner)%>%
  summarise(m = mean(S))

all <- all %>%
  mutate(nname = case_when( ge_winner == "N" ~ "Lost", ge_winner == "W" ~ "Won"))

ggplot(all, aes(x = nname, y = m))+
  geom_bar(stat = "identity")+
  ggtitle(label = "Mean Transaction Amount Received by Winning and Losing Campaigns", subtitle = "Source: FEC")+
  labs(x = "",  y = "Transaction Amount ($)")
  
```



```{r}
d <- house_elections %>%
  group_by(state) %>%
  summarise(n = n_distinct(district))


state <- house_elections %>%
  left_join(contributions, by = c("fec_id" = "cand_id"))%>%
  group_by(state.x) %>%
  filter(!is.na(transaction_amt)) %>%
  summarise(S2 = sum(transaction_amt)) %>%
  left_join(d, by = c("state.x" = "state"))%>%
  mutate(mean_d = S2/n) %>%
  arrange(desc(mean_d))

ggplot(state, aes(x = state.x, y = mean_d))+
  geom_bar(stat = "identity")+
  ggtitle(label = "Mean Transaction Amounts Received by House Election Campaigns by State", subtitle = "Source: FEC")+
  scale_y_continuous(labels= scales::dollar)+
  labs(x = "State",  y = "Transaction Amount ($)")+
  theme(axis.text.x= element_text(angle=45)) 
  
  
```


```{r}
library(readxl)
state_a <- read_excel("state_a.xls")
states <- map_data("state")
states <- states %>%
  left_join(state_a, by = c("region" = "State")) %>%
  left_join(state, by = c("Abreviation" = "state.x"))


base <- ggplot(data = states) + 
  geom_polygon(aes(x = long, y = lat, group = group, fill = mean_d), color = "white")+
  scale_fill_gradient(low = "light green", high = "dark green", guide = FALSE)+
  theme_void()+
  coord_fixed(1.3)

base
```







